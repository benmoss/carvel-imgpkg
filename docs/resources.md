## Resources

## Image

OCI image is an artifact that lives within an OCI registry (like DockerHub). It can contain arbitrary number of files.

---
## Bundle

Bundle is an OCI image that holds 0+ arbitrary files _and_ 0+ references to dependent OCI images. By tracking dependent images imgpkg can copy bundles across registries.

Referenced images are stored within [`.imgpkg` directory](#imgpkg-directory) at the root level of the bundle image. 

![Bundle diagram](images/bundle-diagram.png)

Implementation note: A bundle OCI image has the `dev.carvel.imgpkg.bundle` [label](https://docs.docker.com/config/labels-custom-metadata/) set.

---
## `.imgpkg` directory

`.imgpkg` directory contains metadata files describing bundle:

- `images.yml` (required) file contains [ImagesLock configuration](#imageslock-configuration) that describes 0+ dependent OCI images. Consumers of bundles can conveniently rely on this file being always present.

- `bundle.yml` (optional) file contains [Bundle configuration](#bundle-configuration) that contains details about bundle authors, associated websites, etc.

Restrictions for location of `.imgpkg` directory:

- Only one `.imgpkg` directory is allowed across all directories provided via `-f` to `push` command. This restriction ensures there is a single source of bundle metadata and referenced images.

- The `.imgpkg` directory must be a direct child of one of the input directories. This prevents any confusion around the scope that the `.imgpkg` metadata applies to.

---
## Bundle configuration

Used by bundle creators to store general information about the bundle. Stored in `.imgpkg/bundle.yml`.

Example:

```yaml
apiVersion: imgpkg.carvel.dev/v1alpha1
kind: Bundle
metadata:
  name: my-bundle
authors:
- name: Full Name
  email: name@example.com
websites:
- url: example.com
```

- `authors` (array of structs; optional)
  - `name` (string) Author name
  - `email` (string) Author email
- `websites` (array of structs; optional)
  - `url` (string) Related website URL

---
## ImagesLock configuration

An ImagesLock configuration is used to track collection of image references. 

Bundle's `.imgpkg/images.yml` contains ImagesLock configuration. That's how bundle knows which OCI images it references. When copying a bundle `imgpkg` uses this configuration to know which images to copy.

Can be conveninently generated with [kbld](get-kbld.io):

```bash
$ kbld -f config.yml --imgpkg-lock-output .imgpkg/images.yml
```

Example:

```yaml
apiVersion: imgpkg.carvel.dev/v1alpha1
kind: ImagesLock
spec:
  images:
  - image: docker.io/user1/my-app@sha256:42462d0cb227497976754bb67348bdd7471c7bd159819d6bd63fdf479eb7eb19
    annotaions:
      kbld.carvel.dev/id: "my-app:v1"
  - image: gcr.io/projectX/controller@sha256:6ecba6f14373a449f8d54fa4286f57fb8ef37c4ffa637969551f2fda52672206
```

- `spec` (struct)
  - `images` (array of images): 0+ images
    - `image` (string; required) digest reference to OCI image (tag references are not allowed)
    - `annotations` (map[string]string; optional) arbitrary additional data about image reference. Expected to be used by tools that create or read ImagesLock configuration. Example: [kbld](get-kbld.io) uses annotations to store identifier that tells can later tell it which location within Kubernetes configuration to update with digest reference.

Advanced non-bundle use: See [copying via lock files](commands.md#copying-via-lock-files).

---
## BundleLock configuration

Stores a digest reference to a bundle (as well as the tag it was pushed with).

This configuration is generated by `--lock-output` flag in `push` command.

```yaml
$ imgpkg push -b ... --lock-output /tmp/lock.yml

$ cat /tmp/lock.yml

apiVersion: imgpkg.carvel.dev/v1alpha1
kind: BundleLock
spec:
  image:
    url: docker.io/my-app@sha256:b12026c7a0a6a1756a82a2a74ac759e9a7036523faca0e33dbddebc214e097df
    tag: v1.0
```
